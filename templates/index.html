<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Run Pace Calculator</title>
</head>
<body>
    <div class="container">
        <h1>Run Pace Calc</h1>
        <div class="input-group">
            <label for="time">Time</label>
            <input id="time" type="text" maxlength="6" placeholder="Enter 3~6 digits">
        </div>
        <div class="input-group">
            <div class="distance-label-wrapper">
                <label for="distance">Distance</label>
                <div class="shortcut-buttons">
                    <button class="shortcut" data-value="0.4">400m</button>
                    <button class="shortcut" data-value="0.8">800m</button>
                    <button class="shortcut" data-value="1">1k</button>
                    <button class="shortcut" data-value="3">3k</button>
                    <button class="shortcut" data-value="5">5k</button>
                    <button class="shortcut" data-value="10">10k</button>
                    <button class="shortcut" data-value="21.0975">半马</button>
                    <button class="shortcut" data-value="42.195">全马</button>
                </div>
            </div>
            <div class="distance-wrapper">
                <input id="distance" type="number" step="0.01" placeholder="Enter distance">
                <span class="unit">km &nbsp;&nbsp;&nbsp;&nbsp;</span>
            </div>
        </div>
        <div class="output-group">
            <label for="pace">Pace</label>
            <div id="pace" class="output-box">-</div>
        </div>
    </div>
    <script>
        function calculatePace(timeInSeconds, distance) {
            if (distance > 0) {
                const paceInSeconds = timeInSeconds / distance;
                const minutes = Math.floor(paceInSeconds / 60);
                const seconds = Math.round(paceInSeconds % 60);
                return `${minutes}' ${seconds.toString().padStart(2, '0')}"`;
            }
            return '-';
        }

        function parseTime(raw) {
            raw = raw.replace(/[^0-9]/g, '');
            let hours = 0, minutes = 0, seconds = 0;

            if (raw.length === 1) {
                seconds = parseInt(raw, 10);
            } else if (raw.length === 2) {
                seconds = parseInt(raw, 10);
            } else if (raw.length === 3) {
                hours = parseInt(raw[0], 10);
                minutes = parseInt(raw.slice(1), 10);
            } else if (raw.length === 4) {
                minutes = parseInt(raw.slice(0, 2), 10);
                seconds = parseInt(raw.slice(2), 10);
            } else if (raw.length === 5) {
                hours = parseInt(raw[0], 10);
                minutes = parseInt(raw.slice(1, 3), 10);
                seconds = parseInt(raw.slice(3), 10);
            } else if (raw.length === 6) {
                hours = parseInt(raw.slice(0, 2), 10);
                minutes = parseInt(raw.slice(2, 4), 10);
                seconds = parseInt(raw.slice(4), 10);
            }

            return { hours, minutes, seconds };
        }

        function formatTime(hours, minutes, seconds) {
            return `${hours.toString().padStart(2, '0')} : ${minutes.toString().padStart(2, '0')} : ${seconds.toString().padStart(2, '0')}`;
        }

        const timeInput = document.getElementById('time');
        timeInput.addEventListener('blur', () => {
            const raw = timeInput.value;
            if (raw.length >= 1) {
                const { hours, minutes, seconds } = parseTime(raw);
                timeInput.value = formatTime(hours, minutes, seconds);
                updatePace();
            }
        });

        timeInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && timeInput.value.length >= 3) {
                const raw = timeInput.value;
                const { hours, minutes, seconds } = parseTime(raw);
                timeInput.value = formatTime(hours, minutes, seconds);
                updatePace();
            }
        });

        const distanceInput = document.getElementById('distance');
        document.querySelectorAll('.shortcut').forEach(button => {
            button.addEventListener('click', () => {
                const value = button.getAttribute('data-value');
                distanceInput.value = value;
                updatePace();
            });
        });

        distanceInput.addEventListener('input', updatePace);

        function updatePace() {
            const timeRaw = document.getElementById('time').value;
            const { hours, minutes, seconds } = parseTime(timeRaw);
            const timeInSeconds = hours * 3600 + minutes * 60 + seconds;
            const distance = parseFloat(document.getElementById('distance').value);
            document.getElementById('pace').textContent = calculatePace(timeInSeconds, distance);
        }
    </script>
</body>
</html>
